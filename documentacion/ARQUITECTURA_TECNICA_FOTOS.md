# ğŸ—ï¸ Arquitectura TÃ©cnica - Sistema de IdentificaciÃ³n de Fotos\n\n## Diagrama de Flujo General\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   USUARIO: Toma Foto                        â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                       â”‚\n                       â–¼\n          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n          â”‚  _seleccionarFoto()        â”‚\n          â”‚  - Abre cÃ¡mara/galerÃ­a    â”‚\n          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                           â”‚\n                           â–¼\n          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n          â”‚_guardarFotoConIdentificaciÃ³nâ”‚\n          â”‚- Genera nombre Ãºnico       â”‚\n          â”‚- instalacion_tipo_fecha    â”‚\n          â”‚  _timestamp.jpg            â”‚\n          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                           â”‚\n           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n           â”‚                               â”‚\n           â–¼                               â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Guardar en   â”‚            â”‚ Actualizar       â”‚\n    â”‚ /fotos_      â”‚            â”‚ _fotoMetadata{}  â”‚\n    â”‚ offline/     â”‚            â”‚ key='tipo'       â”‚\n    â”‚              â”‚            â”‚ value='nombre'   â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   USUARIO: Guardar Cambios                  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                       â”‚\n                       â–¼\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚ _guardarCambiosOffline â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                      â”‚\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚                         â”‚\n         â–¼                         â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Guardar en  â”‚         â”‚ Guardar metadata â”‚\n    â”‚ Offline     â”‚         â”‚ en datos offline â”‚\n    â”‚ SyncService â”‚         â”‚ (foto_metadata)  â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              USUARIO: Abre Inconsistencia (EdiciÃ³n)         â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                       â”‚\n                       â–¼\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚  _loadDataOffline()    â”‚\n         â”‚  - Carga datos         â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                      â”‚\n                      â–¼\n       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n       â”‚_cargarFotosExistentes() â”‚\n       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                    â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚                       â”‚\n        â–¼                       â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Buscar en      â”‚    â”‚ Filtrar por          â”‚\nâ”‚ /fotos_offline â”‚    â”‚ instalacion actual   â”‚\nâ”‚                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚\n                                â–¼\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚ Tomar mÃ¡s reciente     â”‚\n                    â”‚ (sort by modified)     â”‚\n                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                 â”‚\n                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                    â”‚                       â”‚\n                    â–¼                       â–¼\n            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n            â”‚ Cargar archivoâ”‚     â”‚ Cargar metadataâ”‚\n            â”‚ a _fotoFile  â”‚      â”‚a _fotoMetadataâ”‚\n            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              USUARIO: Generar PDF                           â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                       â”‚\n                       â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚  _generarPDF()           â”‚\n        â”‚  - Validar campos        â”‚\n        â”‚  - Guardar cambios       â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                     â”‚\n                     â–¼\n       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n       â”‚ _generarPDFLocal()       â”‚\n       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                    â”‚\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚                          â”‚\n        â–¼                          â–¼\n  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n  â”‚ POR CADA FOTOâ”‚        â”‚ Validar pertenenciaâ”‚\n  â”‚              â”‚        â”‚ A INSTALACIÃ“N      â”‚\n  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                   â”‚\n                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n                 â”‚                                â”‚\n            SI (âœ…)                          NO (âŒ)\n                 â”‚                                â”‚\n                 â–¼                                â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Incluir en PDF  â”‚           â”‚ Log Advertencia  â”‚\n        â”‚ Log: \"âœ… Validadaâ”‚           â”‚ Skip esta foto   â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                 â”‚\n                 â–¼\n        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n        â”‚ Guardar PDF     â”‚\n        â”‚ Guardar ruta    â”‚\n        â”‚ en datos offline â”‚\n        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## Estructura de Datos en Memoria\n\n### Durante EdiciÃ³n\n```dart\nclass _EditarInconsistenciaOfflineScreenState {\n  // Archivos de foto\n  File? _fotoFile;      // /path/to/A001_foto_2026-01-20_14-30-00_1705759000000.jpg\n  File? _foto1File;     // /path/to/A001_foto1_2026-01-20_14-30-10_1705759010000.jpg  \n  File? _foto2File;     // /path/to/A001_foto2_2026-01-20_14-30-20_1705759020000.jpg\n  \n  // Metadata de fotos (CLAVE para identificaciÃ³n)\n  Map<String, String> _fotoMetadata = {\n    'foto':  'A001_foto_2026-01-20_14-30-00_1705759000000.jpg',\n    'foto1': 'A001_foto1_2026-01-20_14-30-10_1705759010000.jpg',\n    'foto2': 'A001_foto2_2026-01-20_14-30-20_1705759020000.jpg',\n  };\n  \n  // Datos de la inconsistencia\n  Map<String, dynamic>? _data = {\n    'id': 1,\n    'instalacion': 'A001',\n    'foto': '/path/to/A001_foto_2026-01-20_14-30-00_1705759000000.jpg',\n    'foto_metadata': 'A001_foto_2026-01-20_14-30-00_1705759000000.jpg',  // NUEVO\n    // ... otros campos\n  };\n}\n```\n\n### En Persistencia (OfflineSyncService)\n```json\n[\n  {\n    \"id\": 1,\n    \"instalacion\": \"A001\",\n    \"foto\": \"/data/data/.../fotos_offline/A001_foto_2026-01-20_14-30-00_1705759000000.jpg\",\n    \"foto_metadata\": \"A001_foto_2026-01-20_14-30-00_1705759000000.jpg\",\n    \"foto1\": \"/data/data/.../fotos_offline/A001_foto1_2026-01-20_14-30-10_1705759010000.jpg\",\n    \"foto1_metadata\": \"A001_foto1_2026-01-20_14-30-10_1705759010000.jpg\",\n    \"foto2\": \"/data/data/.../fotos_offline/A001_foto2_2026-01-20_14-30-20_1705759020000.jpg\",\n    \"foto2_metadata\": \"A001_foto2_2026-01-20_14-30-20_1705759020000.jpg\"\n  }\n]\n```\n\n---\n\n## Sistema de Nombramiento de Archivos\n\n### Algoritmo de GeneraciÃ³n\n```dart\nString generatePhotoName({\n  required String instalacion,    // \"A001\"\n  required String tipo,           // \"foto\", \"foto1\", \"foto2\"\n}) {\n  final timestamp = DateTime.now().millisecondsSinceEpoch;  // 1705759000000\n  final fechaHora = DateTime.now()\n    .toString()\n    .substring(0, 19)\n    .replaceAll(' ', '_')\n    .replaceAll(':', '-');  // \"2026-01-20_14-30-00\"\n  \n  return '${instalacion}_${tipo}_${fechaHora}_${timestamp}.jpg';\n}\n\n// Ejemplo de salida:\n// \"A001_foto_2026-01-20_14-30-00_1705759000000.jpg\"\n```\n\n### GarantÃ­as de Unicidad\n1. **InstalaciÃ³n diferente**: A001 vs B002 â†’ Nombres DIFERENTES\n2. **Tipo diferente**: foto vs foto1 â†’ Nombres DIFERENTES  \n3. **Hora diferente**: 14:30:00 vs 14:30:01 â†’ Nombres DIFERENTES\n4. **Mismo segundo**: Milisegundos distintos â†’ Garantizado DIFERENTES\n\n**Probabilidad de colisiÃ³n: 0%** (matemÃ¡ticamente imposible)\n\n---\n\n## ValidaciÃ³n en GeneraciÃ³n de PDF\n\n### Algoritmo de ValidaciÃ³n\n```dart\nbool validarFoto({\n  required String fotosPath,     // \"/path/to/A001_foto_2026-01-20...\"\n  required String instalacion,   // \"A001\"\n}) {\n  final nombreArchivo = fotosPath.split('/').last;\n  \n  // Extraer instalaciÃ³n del nombre\n  final parts = nombreArchivo.split('_');\n  final instalacionEnNombre = parts[0];  // \"A001\"\n  \n  // Comparar\n  if (instalacionEnNombre == instalacion) {\n    print('âœ… Foto validada para instalaciÃ³n: $instalacion');\n    return true;\n  } else {\n    print('âš ï¸ ADVERTENCIA: Foto NO pertenece a instalaciÃ³n $instalacion');\n    print('   Foto pertenece a: $instalacionEnNombre');\n    return false;\n  }\n}\n```\n\n---\n\n## BÃºsqueda de Fotos por InstalaciÃ³n\n\n### Algoritmo de Carga\n```dart\nFuture<File?> buscarFotoMasReciente({\n  required String instalacion,  // \"A001\"\n  required String tipo,         // \"foto\"\n}) async {\n  final directory = await getApplicationDocumentsDirectory();\n  final fotosDir = Directory('${directory.path}/fotos_offline');\n  \n  if (!await fotosDir.exists()) return null;\n  \n  // Buscar archivos que contengan: instalacion_tipo\n  final patron = '${instalacion}_$tipo';\n  final files = fotosDir\n    .listSync()\n    .whereType<File>()\n    .where((f) => f.path.contains(patron))\n    .toList();\n  \n  if (files.isEmpty) return null;\n  \n  // Ordenar por fecha de modificaciÃ³n (mÃ¡s reciente primero)\n  files.sort((a, b) => \n    b.statSync().modified.compareTo(a.statSync().modified)\n  );\n  \n  return files.first;  // Retorna el mÃ¡s reciente\n}\n\n// Complejidad: O(n) donde n = nÃºmero total de fotos\n// En prÃ¡ctica: O(1) porque hay pocas fotos\n```\n\n---\n\n## Persistencia de Metadata\n\n### En SharedPreferences\n```dart\n// Serializar\nfinal all = [...];  // Array de inconsistencias\nall[idx]['foto_metadata'] = _fotoMetadata['foto'];\nawait prefs.setString('inconsistencias_offline', json.encode(all));\n\n// Deserializar\nfinal json_string = prefs.getString('inconsistencias_offline');\nfinal all = json.decode(json_string);\nfinal metadata = all[idx]['foto_metadata'];  // String\n```\n\n### En OfflineSyncService\n```dart\n// Guardar\nfinal all = await OfflineSyncService.getAll();\nall[idx]['foto_metadata'] = nombreArchivo;\nawait OfflineSyncService.saveAll(all);\n\n// Cargar\nfinal all = await OfflineSyncService.getAll();\nfinal metadata = all[idx]['foto_metadata'];  // String con nombre Ãºnico\n```\n\n---\n\n## Manejo de Errores\n\n### Archivo no existe\n```dart\nif (_fotoFile != null && await _fotoFile!.exists()) {\n  // OK: cargar\n} else if (_fotoFile != null) {\n  print('âŒ Error: Archivo no existe: ${_fotoFile!.path}');\n  _fotoFile = null;\n  _fotoMetadata.remove('foto');\n}\n```\n\n### Metadata no coincide\n```dart\nif (fotoMetadata.contains(instalacion)) {\n  // OK: usar foto\n} else {\n  print('âš ï¸ ADVERTENCIA: Metadata no coincide');\n  print('   Esperado: contiene $instalacion');\n  print('   Obtenido: $fotoMetadata');\n  // NO usar esta foto\n}\n```\n\n### Sin espacio en dispositivo\n```dart\ntry {\n  await archivoGuardado.writeAsBytes(imageBytes);\n} catch (e) {\n  print('âŒ Error al guardar foto: $e');\n  if (e.toString().contains('No space')) {\n    // Mostrar diÃ¡logo: \"Libera espacio y vuelve a intentar\"\n  }\n}\n```\n\n---\n\n## Optimizaciones Implementadas\n\n### 1. Cache de Archivos\n```dart\n// Evitar listar directorio mÃºltiples veces\nFile? _fotoFile;  // Cache en memoria\nMap<String, String> _fotoMetadata;  // Cache de metadata\n```\n\n### 2. Sort Eficiente  \n```dart\n// Solo sort el resultado, no todo el directorio\nfiles.sort((a, b) => b.statSync().modified.compareTo(...))\nfiles.first  // O(1)\n```\n\n### 3. ValidaciÃ³n Temprana\n```dart\n// Validar ANTES de leer bytes\nif (fotoMetadata.contains(instalacion)) {\n  final bytes = await _fotoFile.readAsBytes();  // Solo si vÃ¡lido\n}\n```\n\n---\n\n## Escalabilidad\n\n### LÃ­mites Actuales\n- **MÃ¡ximo fotos por instalaciÃ³n**: Ilimitado (pero > 100 consume memoria)\n- **MÃ¡ximo instalaciones**: Ilimitado\n- **MÃ¡ximo tamaÃ±o foto**: 50MB (limitable si es necesario)\n- **MÃ¡ximo espacio total**: Depende del dispositivo\n\n### Mejoras Futuras\n1. **LÃ­mite de antigÃ¼edad**: Borrar fotos > 30 dÃ­as automÃ¡ticamente\n2. **CompresiÃ³n**: Reducir a 2-3MB por foto\n3. **CachÃ© de miniatura**: Para vista previa rÃ¡pida\n4. **SincronizaciÃ³n**: Backup automÃ¡tico a servidor\n5. **Limpieza automÃ¡tica**: Si < 50MB libres, borrar fotos antiguas\n\n---\n\n## Testing\n\n### Unit Tests (Recomendado)\n```dart\ntest('Foto A001 nunca se confunde con B002', () async {\n  final fotoA = await _guardarFotoConIdentificacion(..., 'A001', 'foto');\n  final fotoB = await _guardarFotoConIdentificacion(..., 'B002', 'foto');\n  \n  expect(fotoA['metadata'], contains('A001'));\n  expect(fotoB['metadata'], contains('B002'));\n  expect(fotoA['metadata'], isNot(contains('B002')));\n});\n\ntest('BÃºsqueda solo trae fotos de instalaciÃ³n correcta', () async {\n  final fotosA = await buscarFoto('A001', 'foto');\n  expect(fotosA.every((f) => f.contains('A001')), isTrue);\n});\n```\n\n### Integration Tests\n```dart\ntestWidgets('Flujo completo: Captura â†’ Guarda â†’ Abre â†’ PDF', (tester) async {\n  // 1. Capturar foto\n  await tester.tap(find.byIcon(Icons.photo_camera));\n  \n  // 2. Verificar metadata\n  expect(find.byText(contains('A001_foto')), findsOneWidget);\n  \n  // 3. Guardar cambios\n  await tester.tap(find.byText('GUARDAR'));\n  \n  // 4. Reabrire insistencia\n  // Verificar que carga la foto correcta\n  \n  // 5. Generar PDF\n  // Verificar logs de validaciÃ³n\n});\n```\n"